<% current_user_id = local_assigns[:current_user_id] %>
<% sent_by_me = memory.user_id == current_user_id %>
<div class="container p-3 m-2" id="message-<%= memory.id %>">
  <div class="row <%= sent_by_me ? "justify-content-end" : "justify-content-start" %> mb-2">
    <div class="col-auto">
      <div class="card p-2 <%= sent_by_me ? "bg-success text-black" : "bg-black text-white" %> ">
        <small>
          <strong><%= memory.user.first_name %></strong>
          <i><%= memory.created_at.strftime("%a %b %e at %l:%M %p") %></i>
        </small>
        <%= memory.pet.name %>
        <p><%= memory.text %></p>
      </div>
      <% if memory.media.attached? %>
        <% memory.media.each do |file| %>
          <% if file.blob.content_type.include?("image") %>
            <%= cl_image_tag file.key, width: 400, height: 300, crop: :fill,
                       alt: "memory photo", class: "img-fluid m-3 rounded-3" %>
          <% elsif file.blob.content_type.include?("video") %>
            <%= cl_video_tag file.key,
                       loop: true,
                       controls: true,
                       transformation: [
                         { height: 300, width: 400, crop: "fill", quality: 70, duration: "10"}
                       ], class: "rounded-3",
                       fallback_content: "Your HTML5 video failed." %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
